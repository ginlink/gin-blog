---
sidebar_position: 1
title: 9-3
tags:
  - æ—¥å¸¸è®°å½•
---



## 1 Vscode æœ¬åœ°å®‰è£…æ’ä»¶

[æ‰“åŒ…æºç ä¸ºvsix](https://code.visualstudio.com/api/working-with-extensions/publishing-extension#vsce)

[svg-viewer](https://github.com/cssho/vscode-svgviewer)

## 2 Mui ç»„ä»¶è®¾ç½®é»˜è®¤å€¼

[1] [React Material UI v5 styled with defaultProps](https://stackoverflow.com/questions/71556007/react-material-ui-v5-styled-with-defaultprops)

é¦–å…ˆå¯ä»¥é€šè¿‡ `ç»„ä»¶.defaultProps` ä¿®æ”¹é»˜è®¤å€¼

å…¶æ¬¡ï¼Œä¿®æ”¹é»˜è®¤å€¼æ—¶è¦æŠŠåŸæœ‰å€¼ç»™å¸¦ä¸Š

```tsx
Badge2.defaultProps = {
  ...Badge2.defaultProps,
  variant: 'standard'
}
```

## 3 å°è£… Mui åº“

> TODO

éœ€æ±‚ï¼š

- è®¾ç½®å¥½ä¸»é¢˜
- è¦†ç›–å¸¸è§ç»„ä»¶ï¼Œä¾‹å¦‚ï¼šå¸ƒå±€çš„Rowã€Columnï¼ŒæŒ‰é’®ï¼Œèœå•ç­‰

## 4 LowDB

lowdbæ˜¯ç”¨JSONä¸ºåŸºæœ¬å­˜å‚¨ç»“æ„åŸºäºlodashå¼€å‘çš„ï¼Œæœ‰lodashçš„åŠ æŒ

### lowdbæ“ä½œ

åˆ†ä¸ºå¢åˆ æ”¹æŸ¥

| æ“ä½œ | å…³é”®            | ç¤ºä¾‹                                                         |
| ---- | --------------- | ------------------------------------------------------------ |
| å¢åŠ  | defaults \| set | `db.defaults({ posts: [], user: {}, count: 0 }).write() `    |
| åˆ é™¤ | remove          | `db.unset('user.name').write()`                              |
| æ›´æ–° | update          | `db.update('count', n => n + 1).write()`<br />`db.get('posts').insert({ title: 'xxx', content: 'xxxx' }).write()`<br />`db.set('user.name', 'typicode').write()` |
| æŸ¥è¯¢ | get             | `db.get('posts').find({ id: 1 }).value()`                    |

## 5 Figma

[1] [Figma ä¸­æ–‡ç¤¾åŒº](https://www.figma.cool/)

[2] [ä¼ æ™ºæ•™è‚²Figmaä»é›¶åˆ°ç²¾é€šè§†é¢‘æ•™ç¨‹ï¼Œå…¨ç½‘æœ€å®Œæ•´çš„FigmaåŸºç¡€æ“](https://www.bilibili.com/video/BV1qQ4y167Vd)

## 6 Recoil

[1] [å®˜æ–¹ä¸­æ–‡æ–‡æ¡£](https://recoiljs.org/zh-hans/docs/introduction/motivation)

[2] [recoil-nexus](https://www.npmjs.com/package/recoil-nexus)

Recoil å®šä¹‰äº†ä¸€ä¸ªæœ‰å‘å›¾ (directed graph)ï¼Œæ­£äº¤åŒæ—¶åˆå¤©ç„¶è¿ç»“äºä½ çš„ React æ ‘ä¸Šã€‚çŠ¶æ€çš„å˜åŒ–ä»è¯¥å›¾çš„é¡¶ç‚¹ï¼ˆæˆ‘ä»¬ç§°ä¹‹ä¸º atomï¼‰å¼€å§‹ï¼Œæµç»çº¯å‡½æ•° (æˆ‘ä»¬ç§°ä¹‹ä¸º selector) å†ä¼ å…¥ç»„ä»¶

### ç»å†

- [How to update atoms (state) in Recoil.js outside components ? (React)](https://stackoverflow.com/questions/68945574/how-to-update-atoms-state-in-recoil-js-outside-components-react)



## 7 Mui-dynamic-form

[1] [react-dynamic-material-form](https://github.com/mnikn/react-dynamic-material-form)

[2] [npmæœç´¢ç»“æœ](https://www.npmjs.com/search?q=mui%20dynamic)

Mui åŠ¨æ€è¡¨å•

## 8 React-router ScrollTop

[1] [How to Scroll to Top on Route Change With React Router Dom v6](https://www.matthewhoelter.com/2022/04/02/how-to-scroll-to-top-on-route-change-with-react-router-dom-v6.html)

## 9 èŠ‚æµæ›´æ”¹çŠ¶æ€

```tsx
import throttle from 'lodash/throttle';
const setValueListRef = useRef(throttle((newValue) => setActualValueList(newValue), 1000));
const setValueList = setValueListRef.current;
```

## 10 scrollbarï¼ˆå¯¼èˆªæ ï¼‰

https://stackoverflow.com/questions/59485741/how-to-display-scrollbar-on-hover

## 11 Mui å¦‚ä½•æ›´æ”¹ä¸‹æ‹‰æ¡†çš„æ ·å¼

```tsx
// é€šè¿‡ MenuProps
<Select
  fullWidth
  value={age}
  onChange={handleChange}
  MenuProps={{
    PaperProps: {
      sx: {
        bgcolor: 'pink',
          '& .MuiMenuItem-root': {
            padding: 2,
          },
      },
    },
  }}
  >
```

[1] [Style the dropdown element of MUI Select](https://stackoverflow.com/questions/50353676/style-the-dropdown-element-of-mui-select)

## 12 ç›‘å¬è´¦æˆ·å’Œé“¾å˜åŒ–

åº”ç”¨ï¼šç”¨æˆ·æ–­è¿ï¼Œå¼ºåˆ¶ç™»å‡º

```ts
import { useEffect } from 'react';
import { useWeb3React } from '@web3-react/core';
import { useLoginState } from '@/store/login';

export function useAccountChangeListen() {
  // å½“ç”¨æˆ·æ–­è¿ï¼Œlogout
  const { provider } = useWeb3React();
  const { logout } = useLoginState();

  useEffect(() => {
    const { ethereum } = window;

    if (!provider || !ethereum) {
      return;
    }

    const handleChainChanged = () => {
      logout();
    };
    const handleAccountsChanged = () => {
      logout();
    };

    ethereum.on('chainChanged', handleChainChanged);
    ethereum.on('accountsChanged', handleAccountsChanged);

    return () => {
      if (ethereum.removeListener) {
        ethereum.removeListener('chainChanged', handleChainChanged);
        ethereum.removeListener('accountsChanged', handleAccountsChanged);
      }
    };
  }, [logout, provider]);
}
```

[1] [Listening to the MetaMask account network changes in React.js app](https://stackoverflow.com/questions/71320938/listening-to-the-metamask-account-network-changes-in-react-js-app)

## 13 Suspend & ErrorBoundary & Recoil

è¿™ä¸‰è€…ç»“åˆï¼Œéå¸¸å¾—ä¸æ»‘

çœ‹ä¸€ä¸ªç¤ºä¾‹ï¼š

```tsx
<ErrorBoundary key={userState.account} fallbackRender={() => <UnknownErrorFallback />}>
  <Suspense fallback={<Loading />}>
    <HomeHistory />
  </Suspense>
</ErrorBoundary>
```

å…³é”®ï¼š1.ErrorBoundary çš„key 2.HomeHistoryä¸­ç”¨ Recoil è¿›è¡Œæ•°æ®å±•ç¤º

- ErrorBoundary çš„keyçš„ä½œç”¨æ˜¯é‡ç½®ï¼Œéšç€keyå˜åŒ–ï¼Œä¼šé‡æ–°è§¦å‘ä¸€æ¬¡æ‚¬å¿µ

## 14 è®¾ç½®å¤‡ç”¨å›¾ç‰‡

### backgroundè®¾ç½®å¤šèƒŒæ™¯å›¾ç‰‡

```css
background-imageï¼šurl("images/logo.png"),url("images/errorLogo.png");
```

[1] [å›¾ç‰‡åŠ è½½å¤±è´¥å¦‚ä½•ç”¨é»˜è®¤å›¾ç‰‡ä»£æ›¿](https://juejin.cn/post/6844903833294880781)

## 15 Macåˆ›å»ºè·¨åŸŸChromeå¿«æ·å¯åŠ¨æ–¹å¼

[1] [Macåˆ›å»ºè·¨åŸŸChromeå¿«æ·å¯åŠ¨æ–¹å¼](https://juejin.cn/post/6844903929520586766)

## 16 å‰ç«¯ä¸Šä¼ æ–‡ä»¶Demo

```tsx
<IconButton component="label">
  <input
    ref={inputFileRef}
    hidden
    accept="image/*"
    id="contained-button-file"
    type="file"
    onChange={handleOnChange}
    />
  <Avatar
    alt="Avatar"
    src={image ?? profile?.avatar}
    sx={{ width: '72px', height: '72px' }}
    />
</IconButton>
```

```tsx
const [file, setFile] = useState<File>();

const handleOnChange = useCallback((event: any) => {
  const newImage: File | undefined = event.target?.files?.[0];

  // å‚¨å­˜Fileå®ä½“
  setFile(newImage);
}, []);

// æœ¬åœ°å›¾ç‰‡è·¯å¾„ï¼Œå¯ä»¥ç›´æ¥ç»™imgæ ‡ç­¾
const imageUrl = URL.createObjectURL(file)

<img src={imageUrl} />
```

```tsx
// è¯·æ±‚
await userUploadAvatar(url, file);
```

[1] [Upload button ä¸Šä¼ æŒ‰é’®](https://mui.com/zh/material-ui/react-button/#upload-button)

[2] [AvatarUpload.js](https://gist.github.com/Pacheco95/aa5c28b7a61dacba5b8f55f84d1fa591)

## 17 SocketIoå°è£…

```ts
import {io} from "socket.io-client";

const ENDPOINT = 'ws://localhost:5000/';

export default class SocketService {
  private socket: any = {};

  constructor(private emisor_id?: string) {
    this.socket = io(ENDPOINT);
  }

  public send = (message: string) => {
    this.socket.emit('postMessage', message)
  }

  // disconnect - used when unmounting
  public disconnect (): void {
    this.socket.disconnect();
  }
}
```

```tsx
useEffect(() => {
  const socketService = new SocketService();

  console.log('mount it!');

  return function cleanup() {
    socketService.disconnect();
  }
}, []);
```

[1] [Socket.io disconnect on React client is not triggered on page refresh](https://stackoverflow.com/questions/64343078/socket-io-disconnect-on-react-client-is-not-triggered-on-page-refresh)

## 18 React-router-dom çš„ matchPathæ–¹æ³•

```ts
const match: boolean = matchPath("/users/123", {
  path: "/users/:id",
  exact: true,
  strict: false
});
```

[1] [React-router v6. How is matchPath supposed to work now](https://stackoverflow.com/questions/70259883/react-router-v6-how-is-matchpath-supposed-to-work-now)

[2] https://v5.reactrouter.com/web/api/matchPath/props

## 19 æ¸…é™¤ Mui button çš„ç‚¹å‡»æ ·å¼

```tsx
<Button disableRipple>
  Text
</Button>
```

[1] [How do i change/customize style when MUI button is clicked in reactjs?](https://stackoverflow.com/questions/73045225/how-do-i-change-customize-style-when-mui-button-is-clicked-in-reactjs)

## 20 Inputæ¡†å†…åŠ å›¾æ ‡

[1] [Font Awesome icon inside text input element](https://stackoverflow.com/questions/19285640/font-awesome-icon-inside-text-input-element)

![image-20220914083359406](https://cdn.gincool.com/img/image-20220914083359406.png)

ä¸¤ç§æ–¹å¼ï¼š1.ç»å¯¹å®šä½ 2.ä¼ªå…ƒç´  3.[å½“èƒŒæ™¯](https://stackoverflow.com/questions/917610/put-icon-inside-input-element-in-a-form)

```tsx
.input {
  position: 'relative';
}
.input::after {
  position: 'absolute';
  content: 'ğŸ’';
  right: 0;
}
```

## 21 è®¡ç®—ä¸¤æ—¶é—´çš„å·®å€¼-å°æ—¶åˆ†é’Ÿç§’

[1] [Javascript return number of days,hours,minutes,seconds between two dates](https://stackoverflow.com/questions/13903897/javascript-return-number-of-days-hours-minutes-seconds-between-two-dates)

```ts
import dayjs from 'dayjs';

function computeCountdownProp(now: number | undefined, startTime: number | undefined) {
  const nowD = dayjs(now);
  const targetD = dayjs(startTime);

  if (!nowD || !targetD) {
    return {};
  }

  let delta = targetD.diff(nowD, 'seconds');

  const hours = Math.floor(delta / 3600);
  delta -= hours * 3600; // æŠŠå°æ—¶å‡æ‰ï¼Œå‰©ä½™åˆ†+ç§’

  const minutes = Math.floor(delta / 60);
  delta -= minutes * 60; // æŠŠåˆ†é’Ÿå‡æ‰ï¼Œå‰©ä½™ç§’

  const seconds = delta;

  return {
    hours: hours < 0 ? 0 : hours,
    minutes: minutes < 0 ? 0 : minutes,
    seconds: seconds < 0 ? 0 : seconds,
  };
}

export { computeCountdownProp };
```

### âŒ é”™è¯¯ç¤ºä¾‹

è¿™æ ·ä¼šè®¡ç®—é‡å¤

```ts
const hours = targetD.diff(nowD, 'hours');
const minutes = targetD.diff(nowD, 'minutes');
const seconds = targetD.diff(nowD, 'seconds');

return {
  hours: hours < 0 ? 0 : hours,
  minutes: minutes < 0 ? 0 : minutes,
  seconds: seconds < 0 ? 0 : seconds,
};
```

## 22 Reactä¸é˜²æŠ–

[1] [How to use throttle or debounce with React Hook?](https://stackoverflow.com/questions/54666401/how-to-use-throttle-or-debounce-with-react-hook)

âœ… å¸¸è§„åšæ³•

```tsx
import { throttle } from 'lodash'

const App = () => {
  const [value, setValue] = useState(0)
  const throttled = useRef(throttle((newValue) => console.log(newValue), 1000))

  useEffect(() => throttled.current(value), [value])

  return (
    <button onClick={() => setValue(value + 1)}>{value}</button>
  )
}
```

## 23 Reactä¸­å¦‚ä½•æ ‡æ³¨äº‹ä»¶ç±»å‹

1.é”®ç›˜äº‹ä»¶

[1] [Fix TypeScript error: Property â€˜keyCodeâ€™ does not exist on type â€˜FormEventâ€™.](https://www.garysieling.com/blog/fix-typescript-error-property-keycode-not-exist-type-formevent/)

```tsx
onKeyUp(event: React.KeyboardEvent<object>) {
  event.preventDefault(); 

  if (event.keyCode === 13) {      
  }
}
```

2.inputå˜åŒ–äº‹ä»¶

[1] [Typescript input onchange event.target.value](https://stackoverflow.com/questions/40676343/typescript-input-onchange-event-target-value)

```tsx
onChange = (e: React.ChangeEvent<HTMLInputElement>)=> {
  const newValue = e.target.value;
}
```

## 24 èŠå¤©æ¡†è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨

[1] [Automatically scroll down chat div](https://stackoverflow.com/questions/25505778/automatically-scroll-down-chat-div)

```tsx
if (firstTime) {
  container.scrollTop = container.scrollHeight;
  firstTime = false;
} else if (container.scrollTop + container.clientHeight === container.scrollHeight) {
  container.scrollTop = container.scrollHeight;
}
```

## 25 å¦‚ä½•å…³é—­å³é”€æ¯Muiæ¨¡æ€æ¡†

[1] [How to handle "outside" click on Dialog (Modal)?](https://stackoverflow.com/questions/57329278/how-to-handle-outside-click-on-dialog-modal)

- å¦‚ä½•å…³é—­å³é”€æ¯Muiæ¨¡æ€æ¡†ï¼Ÿ

- å¦‚ä½•å…³é—­ç‚¹å‡»å¤–éƒ¨å…³é—­æ¨¡æ€æ¡†çš„ç‰¹æ€§ï¼Ÿ

  ```tsx
  const handleClose = (event, reason) => {
      if (reason && reason == "backdropClick") 
          return;
      myCloseModal();
  }
  
  <Dialog onClose={handleClose} />
  ```

- Mui stackçš„ `rowSpacing` å’Œ `columnSpacing` åŒºåˆ«
  - rowSpacingä»£è¡¨è¡Œé—´è·
  - columnSpacingåˆ—é—´è·

> TODO

## 26 åœ¨Reactä¸­ä½¿ç”¨socketio.clientçš„æœ€ä½³å®è·µ

[1] [Cannot close the socket when logout](https://stackoverflow.com/questions/61906608/cannot-close-the-socket-when-logout)

> TODO

## 27 å¦‚ä½•è·å–ä¸€ä¸ªäº¤æ˜“çš„ç¡®è®¤å—

æ€æƒ³ï¼šé€šè¿‡getTransactionReceiptè½®è¯¢æŸ¥äº¤æ˜“çš„æ”¶æ®ï¼Œæ”¶æ®ä¸­å¸¦æœ‰confirmationså­—æ®µ

```ts
import { useCallback, useEffect, useMemo, useState } from 'react';

import { TransactionReceipt } from '@ethersproject/abstract-provider';
import { useWeb3React } from '@web3-react/core';
import { ethers } from 'ethers';

import { SupportedChainId } from '@/constants/chains';
import { RetryOptions, RetryableError, retry } from '@/utils/retry';

const RETRY_OPTIONS_BY_CHAIN_ID: { [chainId: number]: RetryOptions } = {
  [SupportedChainId.POLYGON]: { n: 50, minWait: 1000, maxWait: 2500 },
  [SupportedChainId.POLYGON_MUMBAI]: { n: 50, minWait: 1000, maxWait: 2500 },
};
const DEFAULT_RETRY_OPTIONS: RetryOptions = { n: 1, minWait: 0, maxWait: 0 };

function useBlockConfirm(tx: ethers.ContractTransaction | undefined) {
  const { chainId, provider } = useWeb3React();
  const [blockConfirmed, setBlockConfirmed] = useState<number>();

  const { hash } = useMemo(() => tx, [tx]) || {};

  const onReceipt = useCallback(
    (tx: { chainId: number; hash: string; receipt: TransactionReceipt }) => {
      setBlockConfirmed(tx.receipt.confirmations);

      console.log('[tx]:', tx);
    },
    [],
  );

  const getReceipt = useCallback(
    (hash: string) => {
      if (!provider || !chainId) throw new Error('No provider or chainId');
      const retryOptions = RETRY_OPTIONS_BY_CHAIN_ID[chainId] ?? DEFAULT_RETRY_OPTIONS;
      return retry(
        () =>
        provider.getTransactionReceipt(hash).then((receipt) => {
          if (receipt === null) {
            console.debug(`Retrying tranasaction receipt for ${hash}`);
            throw new RetryableError();
          }

          if (receipt.confirmations < 3) {
            onReceipt({ chainId, hash, receipt });

            console.debug(`Retrying tranasaction receipt for ${hash}`);
            throw new RetryableError();
          }
          return receipt;
        }),
        retryOptions,
      );
    },
    [chainId, onReceipt, provider],
  );

  useEffect(() => {
    if (!chainId || !hash) {
      return;
    }

    const { promise, cancel } = getReceipt(hash);
    promise
      .then((receipt) => {
      if (receipt) {
        onReceipt({ chainId, hash, receipt });
      } else {
        console.log('[no receipt]:');
      }
    })
      .catch((error) => {
      if (!error.isCancelledError) {
        console.warn(`Failed to get transaction receipt for ${hash}`, error);
      }
    });

    return () => {
      cancel();
    };
  }, [chainId, getReceipt, hash, onReceipt]);

  useEffect(() => {
    if (!tx) {
      setBlockConfirmed(undefined);
    }
  }, [tx]);

  return useMemo(
    () => ({
      blockConfirmed,
    }),
    [blockConfirmed],
  );
}

export { useBlockConfirm };
```

