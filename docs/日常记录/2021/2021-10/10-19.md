---
sidebar_position: 1
title: 10-19
tags:
  - æ—¥å¸¸è®°å½•
---



# 1 Babel

ç›®çš„ï¼š

- babelæ˜¯ä»€ä¹ˆï¼Ÿåšä»€ä¹ˆï¼Ÿ
- babelåŸç†ï¼Ÿ

ä¸€äº›é‡ç‚¹ï¼š

- babelæ˜¯åŸºäºæ’ä»¶çš„ï¼Œå¦‚æœæ²¡æœ‰é…ç½®æ’ä»¶ï¼ˆé¢„è®¾ï¼‰ï¼Œåˆ™babelä¸ä¼šè¿›è¡Œè½¬åŒ–

ä¸€äº›å…³è”é—®é¢˜ï¼š

- [x] babelä¸corejsçš„å…³ç³»æ˜¯ä»€ä¹ˆï¼Ÿbabelçš„ä¸€ä¸ªæ’ä»¶ä¾èµ–corejsï¼Œè¯¦è§é—®é¢˜äºŒ
- [x] BrowserListæ˜¯ä»€ä¹ˆï¼Ÿbabelçš„ä¸€ä¸ªæ’ä»¶ä¾èµ–BrowserListï¼Œè¯¦è§é—®é¢˜ä¸€
- [ ] postcssæ’ä»¶åˆæ˜¯å¹²ä»€ä¹ˆçš„ï¼Ÿ
- [ ] jsä¸­çš„Reflectï¼ˆåå°„ï¼‰æ˜¯ä»€ä¹ˆï¼Ÿ

ä»‹ç»ï¼šbabelæ˜¯ä¸€ä¸ªèƒ½å¤Ÿå°†es2015ï¼ˆes6ï¼‰ä»¥ä¸Šçš„jsè¯­æ³•è½¬æ¢ä¸ºes5çš„è¯­æ³•ã€‚

```js
// Babel Input: ES2015 arrow function
[1, 2, 3].map(n => n + 1);

// Babel Output: ES5 equivalent
[1, 2, 3].map(function(n) {
  return n + 1;
});
```

### é—®é¢˜ä¸€ï¼šBrowserlist

babelä¸browserlistçš„å…³ç³»ï¼š

By default `@babel/preset-env` will use [browserslist config sources](https://github.com/ai/browserslist#queries) *unless* either the [targets](https://babeljs.io/docs/en/babel-preset-env#targets) or [ignoreBrowserslistConfig](https://babeljs.io/docs/en/babel-preset-env#ignorebrowserslistconfig) options are set.

### é—®é¢˜äºŒï¼šbabelä¸corejsçš„å…³ç³»æ˜¯ä»€ä¹ˆï¼Ÿ

[corejs](https://github.com/zloirock/core-js) æ˜¯ä¸€ä¸ªç°ä»£å¡«å……åº“ï¼ˆModular standard library for JavaScript.ï¼‰ï¼Œæ”¯æŒ `state>0` çš„Ecma-262çš„ææ¡ˆã€‚

[babel](https://github.com/babel/babel) æ˜¯ä¸€ä¸ªå·¥å…·é“¾ï¼Œä¸»è¦ç”¨äºåœ¨å½“å‰å’Œæ—§æµè§ˆå™¨æˆ–ç¯å¢ƒä¸­å°† ECMAScript 2015+ ä»£ç è½¬æ¢ä¸ºå‘åå…¼å®¹çš„ JavaScript ç‰ˆæœ¬ã€‚

> æ³¨æ„ï¼šbabelèƒ½å¤Ÿè¿›è¡Œä¸¤éƒ¨åˆ†è½¬åŒ–ï¼Œè¯­æ³•è½¬åŒ–å’ŒAPIè½¬åŒ–ã€‚

babelæœ¬èº«ä¸å¸¦æœ‰ä»»ä½•ä½œç”¨ï¼Œéƒ½æ˜¯ä¾é æ’ä»¶è¿›è¡Œå·¥ä½œï¼Œä¾‹å¦‚ï¼š@babel/preset-envã€@babel/polyfillç­‰

@babel/preset-envæœ¬èº«åªæœ‰è¯­æ³•è½¬åŒ–çš„åŠŸèƒ½ï¼Œå¦‚æœé…ç½®äº†useBuiltInsï¼Œåˆ™å¯ä»¥åˆ©ç”¨@babel/polyfillè¿›è¡ŒAPIå¡«å……ï¼Œè€Œ@babel/polyfillæœ¬èº«åˆ©ç”¨corejsè¿›è¡Œå¡«å……ï¼Œæ‰€ä»¥è¿™å°±æ˜¯å®ƒä»¬ä¿©çš„å…³ç³»ã€‚

ä½†babel v7.4.0ä»¥ä¸Šä¸åœ¨å»ºè®®ä½¿ç”¨@babel/polyfill ï¼Œè€Œæ˜¯ä½¿ç”¨core-js/stableã€regenerator-runtime/runtimeä»£æ›¿ã€‚

å†æ¥çœ‹çœ‹ `@babel/core`ï¼Œå®ƒæ˜¯babelçš„ç¼–è¯‘å™¨ï¼ŒåŒ…å«ä¸‰ä¸ªéƒ¨åˆ†ï¼Œ@babel/paserã€@babel/traverseã€@babel/generatorï¼Œä¹Ÿå°±æ˜¯è§£æä»£ç ä¸º[AST](https://astexplorer.net/)ã€è½¬åŒ–ASTã€ç”Ÿæˆä»£ç 

å†æ¥çœ‹çœ‹ `@babel/preset-env`ï¼Œå®ƒæ˜¯babelçš„ä¸€ç»„æ’ä»¶çš„é›†åˆï¼Œå®ƒèƒ½å¤Ÿå°†es2015+çš„ä»£ç è½¬åŒ–ä¸ºç›®æ ‡ä»£ç ï¼ˆé»˜è®¤ä¸ºes5ï¼‰

[1] babel,babel-coreæ˜¯ä»€ä¹ˆå…³ç³»ï¼Ÿåˆ†ä¸æ¸…ä»–ä»¬çš„èŒè´£ï¼Ÿ.https://www.zhihu.com/question/277409645

[2] äº†è§£babelï¼špolyfillã€loaderã€ preset-envåŠ coreä¹‹é—´çš„å…³ç³».https://zhuanlan.zhihu.com/p/138108118

# 2 safeTransferFrom is not a function

åŸå› ï¼šabiæ–‡ä»¶æœ‰å¤šä¸ªæ–¹æ³•ï¼Œå®ƒä¼šä¼˜å…ˆè®¿é—®ç¬¬ä¸€ä¸ªæ–¹æ³•

:white_check_mark: è§£å†³æ–¹æ¡ˆï¼šåˆ é™¤å¤šä½™æ–¹æ³•å³å¯ï¼Œæ­¤å¤„ä¸ºsafeTransferFromæ–¹æ³•

# 3 styled-componentsçš„ç”Ÿæ€ç³»ç»Ÿ

ç”Ÿæ€ç³»ç»Ÿï¼šhttps://styled-components.com/ecosystem

é‡Œé¢åŒ…å«å¾ˆå¤šåœ¨styled-componentsåŸºç¡€ä¸Šå®ç°çš„åº“

```ts
import { ApolloClient, HttpLink, ApolloLink, InMemoryCache, concat } from '@apollo/client';

const httpLink = new HttpLink({ uri: '/graphql' });

const authMiddleware = new ApolloLink((operation, forward) => {
  // add the authorization to the headers
  operation.setContext(({ headers = {} }) => ({
    headers: {
      ...headers,
      authorization: localStorage.getItem('token') || null,
    }
  }));

  return forward(operation);
})

const client = new ApolloClient({
  cache: new InMemoryCache(),
  link: concat(authMiddleware, httpLink),
});
```

# 4 nodejsçš„å®˜ç½‘å¥½å¥½çœ‹ä¸€ä¸‹

nodejså®˜ç½‘æ–‡æ¡£14.8.1ï¼šhttps://nodejs.org/dist/latest-v14.x/docs/api/fs.html#fs_promise_example

# 5 åœ¨reactä¸­æƒ³æ¸²æŸ“ç©ºæ ¼çš„æ–¹æ³•

æœ‰ä¸¤ç§æ–¹æ³•

### ç¬¬ä¸€ç§ï¼šç”¨{' '}

```tsx
<Text>{' '}123</Text>

=>> 123
```

### ç¬¬äºŒç§ï¼šç”¨htmlæ ‡è®°ç¬¦

```tsx
&nbsp;123
=>> 123
```

# 6 jsdelivrçš„CDNç¼“å­˜

åœ¨githubä¸Šé¢çš„å…¬å¼€é¡¹ç›®ï¼Œå¦‚æœæ‰“äº†ä¸€ä¸ªç‰ˆæœ¬å·ï¼Œé‚£ä¹ˆè‡ªåŠ¨è¿›å…¥jsdelivrçš„CDNç¼“å­˜

### ç¬¬ä¸€æ­¥ï¼šå‘å¸ƒä¸€ä¸ªç‰ˆæœ¬

### ç¬¬äºŒæ­¥ï¼šå¼•ç”¨ç½‘å€

```ts
https://cdn.jsdelivr.net/gh/ä½ çš„ç”¨æˆ·å/ä½ çš„ä»“åº“å@å‘å¸ƒçš„ç‰ˆæœ¬å·/æ–‡ä»¶è·¯å¾„

//ä¾‹å¦‚ï¼šåŠ è½½ jQuery v3.2.1
https://cdn.jsdelivr.net/gh/jquery/jquery@3.2.1/dist/jquery.min.js
```

# 7 package.workspaceså±æ€§ä½œç”¨

ä»‹ç»ï¼šå®ƒèƒ½å¤ŸæŒ‡å®šå¤šä¸ªåŒ…ï¼Œè€Œç”¨ `yarn` ä¹‹åå¯ä»¥å®‰è£…å¤šä¸ªé¡¹ç›®çš„ä¾èµ–

### ç¤ºä¾‹ï¼šåœ¨æ ¹ç›®å½•ä¸‹å®‰è£…å¤šä¸ªé¡¹ç›®çš„ä¾èµ–

```ts
//rootä¸‹
package.json
packages
-- A
-- -- package.json
-- B
-- -- package.json
```

åœ¨rootç›®å½•ä¸‹çš„package.jsonå†…å®¹å¦‚ä¸‹ï¼š

```json
{
  "name": "root",
  "private": true,
  "npmClient": "yarn",
  "usingWorkspances": true,
  "workspaces": {
    "packages": [
      "packages/*" //é‡ç‚¹
    ],
    "nohoist": [
      "**/*",
      "**/**"
    ]
  },
}
```

è€ŒAä¸‹çš„package.json

```json
{
  "name": "@test/admin",
  "version": "0.0.1",
  "private": true,
}
```

Bä¸‹çš„package.json

```json
{
  "name": "@test/sever",
  "version": "0.0.1",
  "private": true,
}
```

é‚£ä¹ˆå¦‚æœåœ¨æ ¹ç›®å½•è¿è¡Œ `yarn` ï¼Œåˆ™ä¼šå®‰è£…ä¸‰ä¸ªpackage.jsonå¯¹åº”çš„ä¾èµ–ï¼Œå¹¶åœ¨æ ¹ç›®å½•çš„node_modulesä¸‹æŒ‚è½½Aã€BåŒ…çš„ä¾èµ–è·¯å¾„

# 7 [ç§‘æ™®]å°ç™½å¦‚ä½•ç†è§£UniswapV3ç™½çš®ä¹¦

## v2å’Œv3çš„æ ¸å¿ƒå…¬å¼

å…¶å®ï¼Œå®ƒä»¬çš„æ ¸å¿ƒå…¬å¼éƒ½æ˜¯

```
x*y = k
```

åªæ˜¯åœ¨v3ä¸­å¼•å…¥äº†è™šæ‹Ÿæ•°é‡ï¼Œå¯¼è‡´xå’Œyåˆ†æˆäº†ä¸¤éƒ¨åˆ†

```ts
(x + â–³x)(y + â–³y) = k
```

æ‰€ä»¥å›¾å°±åƒå·¦ä¸‹è§’ç§»åŠ¨äº†ï¼ŒæµåŠ¨æ€§èŒƒå›´åˆ©ç”¨ç‡æé«˜äº†ï¼ˆæ©™è‰²éƒ¨åˆ†ï¼‰ï¼Œè€Œæ–œç‡ï¼ˆä»·æ ¼ï¼‰ä¸å˜ã€‚

![image-20211022111607701](https://cdn.gincool.com//img/image-20211022111607701.png)

## æ·»åŠ æµåŠ¨æ€§æ•°é‡è®¡ç®—

åŒºé—´å†…

```ts
L = delta x * (âˆšp * âˆšp_{upper}) / (âˆšp_{upper} - âˆšp)
L = delta y / âˆš(p - p_{lower})

Lè¡¨ç¤ºk=ğ¿^2ï¼ŒL=âˆšk
pè¡¨ç¤ºä»·æ ¼
delta xè¡¨ç¤ºè¦æ·»åŠ çš„xæ•°é‡
delta yè¡¨ç¤ºè¦æ·»åŠ çš„yæ•°é‡
```

é«˜äºåŒºé—´

```ts
L = delta y / âˆš(p_{upper} - p_{lower})
```

ä½äºåŒºé—´

```ts
L = delta x * (âˆšp_{upper} * âˆšp_{lower}) / (âˆšp_{upper} - âˆšp_{lower})
```

[1] å¦‚ä½•è®¡ç®—å¯¼æ•°ï¼Ÿhttps://www.shuxuele.com/calculus/derivatives-introduction.html

[2] [ç§‘æ™®]å°ç™½å¦‚ä½•ç†è§£UniswapV3ç™½çš®ä¹¦.https://learnblockchain.cn/article/3055

[3] [ç§‘æ™®]ç”±æµ…å…¥æ·±ç†è§£uniswapV3åŸç†ã€è§†é¢‘ã€‘.https://www.bilibili.com/video/BV1uq4y1N7o6?from=search&seid=12157076229729745114&spm_id_from=333.337.0.0

# 8 Typescriptæ¥å£å‘½åè§„èŒƒ

ä¸ç”¨åŠ I

# 9 GraphQL

### é—®é¢˜ä¸€ï¼šGraphQLä¸SQLçš„åŒºåˆ«ï¼Ÿ

SQLæ˜¯`Structured Query Language`ï¼ŒGraphQLå¾ˆæ˜¾ç„¶ï¼Œæ˜¯`Graph Query Language`ï¼Œå®ƒä»¬çš„åŒºåˆ«å¦‚ä¸‹ï¼š

- SQLçš„æ•°æ®æºæ˜¯æ•°æ®åº“ï¼ŒGraphQLçš„æ•°æ®æºå¯ä»¥æ˜¯restful APIï¼Œå„ç§æœåŠ¡/å¾®æœåŠ¡ï¼Œæˆ–è€…æ•°æ®åº“ã€‚
- MySQLæ˜¯SQLçš„å®ç°ï¼ŒApollo, Relayä¹Ÿæ˜¯GraphQLè§„èŒƒçš„å®ç°

[1] GraphQLå…¥é—¨&serveræ­å»ºï¼ˆä¸€ï¼‰.https://juejin.cn/post/6978395879040516110

### é—®é¢˜äºŒï¼šGraphQLå¦‚ä½•ä»¥ä»¥å¤ªåŠç½‘ç»œçš„æ•°æ®ä¸ºæ•°æ®æºï¼Ÿ

è¿™é‡Œéœ€è¦çŸ¥é“ä¸‰ä¸ªåº“ï¼š

- [Graph Node](https://github.com/graphprotocol/graph-node/blob/master/README.md) â€“ ä¸€ç§æœåŠ¡å™¨å®ç°ï¼Œç”¨äºå¯¹æ¥è‡ªä»¥å¤ªåŠçš„æ•°æ®è¿›è¡Œç´¢å¼•ã€ç¼“å­˜å’ŒæœåŠ¡æŸ¥è¯¢ã€‚
- [Graph CLI](https://github.com/graphprotocol/graph-cli) â€“ ç”¨äºæ„å»ºå’Œç¼–è¯‘éƒ¨ç½²åˆ° Graph èŠ‚ç‚¹çš„é¡¹ç›®çš„ CLIã€‚
- [Graph TypeScript Library](https://github.com/graphprotocol/graph-ts) â€“ TypeScript/AssemblyScript åº“ï¼Œç”¨äºç¼–å†™è¦éƒ¨ç½²åˆ° The Graph çš„å­å›¾æ˜ å°„ã€‚

å¤§è‡´æµç¨‹ä¸ºï¼šç¨‹åºå‘˜åˆ©ç”¨TSç¼–å†™å­å›¾æ˜ å°„ï¼Œé€šè¿‡CLIå·¥å…·æ„å»ºã€ç¼–è¯‘å’Œéƒ¨ç½²åˆ°Nodeä¸Šã€‚Nodeä¼šæä¾›urlä»¥ä¾›GraphQLå®¢æˆ·ç«¯æŸ¥è¯¢ï¼ˆApolloå®¢æˆ·ç«¯ï¼Œæ˜¯GraphQLçš„å®ç°ï¼‰ã€‚

å›åˆ°é—®é¢˜æœ¬èº«ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ˜¯Nodeåœ¨å¸®æˆ‘ä»¬æ“ä½œï¼Œåœ¨è·å–ä»¥å¤ªåŠç½‘ç»œçš„æ•°æ®ã€‚

å¯ä»¥çœ‹ä»¥ä¸‹å›¾ï¼Œè¡¨ç¤ºå‰ç«¯Dappåº”ç”¨å’Œæ™ºèƒ½åˆçº¦ä¸æ•´ä¸ªä»¥å¤ªåŠç½‘ç»œçš„æ•°æ®åŒæ­¥å’Œæ£€ç´¢çš„æµç¨‹ï¼š

![image-20211025095005983](https://cdn.gincool.com//img/image-20211025095005983.png)

[1] graphåè®®.https://github.com/graphprotocol

[2] graphåè®®å…¥é—¨.https://github.com/graphprotocol/graph-node/blob/master/docs/getting-started.md

[3] assemblyscript.https://github.com/AssemblyScript/assemblyscript

### é—®é¢˜ä¸‰ï¼šå¦‚ä½•åŸºäºå·²æœ‰çš„ REST API å®ç° GraphQL APIï¼Ÿ

dad-joke-dadabaseé¡¹ç›®ï¼ˆçˆ¸çˆ¸ç¬‘è¯ï¼‰ï¼šhttps://github.com/thawkin3/dad-joke-dadabase

[1] å¦‚ä½•åŸºäºå·²æœ‰çš„ REST API å®ç° GraphQL API.https://juejin.cn/post/6930911717950947341

# 10 æ­»æ´»å®‰è£…ä¸ä¸Š `sharp`

è§£å†³ï¼šå›å®¶é‡æ–°yarnï¼Œå®‰è£…ä¸Šäº†ï¼Œå…¬å¸ç½‘ç»œé—®é¢˜

# 11 é›·ç”µæ¨¡æ‹Ÿå™¨3.0æ— æ³•ä½¿ç”¨ `æŒ‡é’ˆä½ç½®` åŠŸèƒ½

è§£å†³æ–¹æ¡ˆï¼šéœ€è¦åœ¨æ¨¡æ‹Ÿå™¨æ‰€åœ¨çš„VMSæ–‡ä»¶å¤¹æ–°å»ºä¸€ä¸ªdebugçš„ç©ºTXTæ–‡æœ¬

### é—®é¢˜ä¸€ï¼šä¸ºä»€ä¹ˆç”¨3.0çš„ç‰ˆæœ¬ï¼Ÿ

å› ä¸º3.0æ”¯æŒå­¦ä¹ å¼ºå›½çš„è§†é¢‘æ’­æ”¾

[1] å¼€å‘è€…æ¨¡å¼çš„æŒ‡é’ˆä½ç½®å¼€å¯åä¸èµ·ä½œç”¨.https://www.ldmnq.com/forum/72566.html

# 12 LuaåŸºç¡€è¯­æ³•

### æ¨¡æ‹Ÿç±»å†™æ³•

ç¬¬ä¸€ç§ï¼š

```lua
Person = {}

Person.speak = function (self)
    ... 
end

-- è°ƒç”¨
Person:speak()
```

ç¬¬äºŒç§ï¼š

```lua
function Person:speak()
    ...
end

-- è°ƒç”¨
Person:speak()
```

### é€»è¾‘è¿ç®—ç¬¦

```lua
or and not
```

### è·å–æ—¶é—´æˆ³

```lua
os.time()
-- è·å–ç§’çº§åˆ«æ—¶é—´æˆ³
```

### æŠ›å‡ºé”™è¯¯

```lua
error(msg, [level])
```

[1] Lua åŸºç¡€ç®€æ˜æ•™ç¨‹.https://www.cnblogs.com/xiand/p/6699964.html

# 13 Macå®‰è£…MongoDB

ä¸è¦æ€•éº»çƒ¦ï¼Œä¸¤æ­¥ï¼Œä¸‹è½½ã€è§£å‹-> é…ç½®ç¯å¢ƒå˜é‡

ç¬¬ä¸€æ­¥ï¼šä¸‹è½½ç¤¾åŒºç‰ˆMongoDB

https://www.mongodb.com/try/download/community

ç¬¬äºŒæ­¥ï¼šæ”¾åˆ°è‡ªå·±å–œæ¬¢çš„ç›®å½•ï¼ˆç­‰ä¸‹è¦ç”¨ï¼‰ï¼Œè§£å‹

ç¬¬ä¸‰æ­¥ï¼šè®¾ç½®ç¯å¢ƒå˜é‡ï¼Œè®©mongoå‘½ä»¤ç”Ÿæ•ˆ

```sh
#mongo
export PATH="/Users/jiangjin/Documents/static-app/mongodb-macos-x86_64-5.0.3/bin:$PATH"
```

æ³¨æ„è½¯ä»¶è·¯å¾„

# 14 box.shadowï¼ˆx,y,æ¨¡ç³ŠåŠå¾„,æ‰©æ•£åŠå¾„,é¢œè‰²)

å¦‚é¢˜

# 15 yarn global addçš„è½¯ä»¶æ— æ³•åœ¨å…¨å±€è®¿é—®ï¼ˆMacï¼‰

åœ¨ `.bash_profile` ä¸­æ·»åŠ 

```sh
export PATH="$PATH:`yarn global bin`:$HOME/.config/yarn/global/node_modules/.bin" 
```

ä¹‹åå†sourceä¸€ä¸‹

```sh
source ~/.bash_profile
```

### :warning: é™„ï¼Œè¿™æ ·æ·»åŠ  `æ—  `æ•ˆ

```sh
export PATH="$PATH:`yarn global bin`"
export PATH="/Users/jiangjin/.yarn/bin:$PATH"
```

### é™„ï¼ŒyarnæŸ¥çœ‹å…¨å±€å®‰è£…è·¯å¾„

```sh
yarn global dir
```

[1] [è®°å½•]è§£å†³MACä½¿ç”¨ yarn å®‰è£…å…¨å±€åŒ…åæ‰¾ä¸åˆ°å‘½ä»¤çš„é—®é¢˜.export PATH="$PATH:`yarn global bin`:$HOME/.config/yarn/global/node_modules/.bin"

# 16 é‡æ–°å®¡è§†GraphQL

æ€»ä½“ä¸Šæ¥è®²GraphQLåˆ†ä¸ºæŸ¥è¯¢ï¼ˆå˜æ›´ï¼‰è¯­è¨€ã€ç±»å‹ç³»ç»Ÿã€æ‰§è¡Œå’Œå†…çœ

| æŸ¥è¯¢å’Œå˜æ›´                   | Schema å’Œç±»å‹                                  |
| ---------------------------- | ---------------------------------------------- |
| å­—æ®µï¼ˆFieldsï¼‰               | ç±»å‹ç³»ç»Ÿï¼ˆType Systemï¼‰                        |
| å‚æ•°ï¼ˆArgumentsï¼‰            | ç±»å‹è¯­è¨€ï¼ˆType Languageï¼‰                      |
| åˆ«åï¼ˆAliasesï¼‰              | å¯¹è±¡ç±»å‹å’Œå­—æ®µï¼ˆObject Types and Fieldsï¼‰      |
| ç‰‡æ®µï¼ˆFragmentsï¼‰            | å‚æ•°ï¼ˆArgumentsï¼‰                              |
| æ“ä½œåç§°ï¼ˆOperation Nameï¼‰   | æŸ¥è¯¢å’Œå˜æ›´ç±»å‹ï¼ˆThe Query and Mutation Typesï¼‰ |
| å˜é‡ï¼ˆVariablesï¼‰            | æ ‡é‡ç±»å‹ï¼ˆScalar Typesï¼‰                       |
| æŒ‡ä»¤ï¼ˆDirectivesï¼‰           | æšä¸¾ç±»å‹ï¼ˆEnumeration Typesï¼‰                  |
| å˜æ›´ï¼ˆMutationsï¼‰            | åˆ—è¡¨å’Œéç©ºï¼ˆLists and Non-Nullï¼‰               |
| å†…è”ç‰‡æ®µï¼ˆInline Fragmentsï¼‰ | æ¥å£ï¼ˆInterfacesï¼‰                             |
|                              | è”åˆç±»å‹ï¼ˆUnion Typesï¼‰                        |
|                              | è¾“å…¥ç±»å‹ï¼ˆInput Typesï¼‰                        |

è¿˜æœ‰éªŒè¯ã€æ‰§è¡Œï¼ˆresolverï¼‰ã€å†…çœï¼ˆæŸ¥è¯¢æ”¯æŒç±»å‹ï¼‰

## æŸ¥è¯¢è¯­è¨€

æŸ¥è¯¢ä¸­åˆåˆ†ä¸ºï¼šåˆ«åã€ç‰‡æ®µ&å†…è”ç‰‡æ®µã€å˜é‡ã€æŒ‡ä»¤ã€å˜æ›´

### å˜é‡ï¼š

åŠ¨æ€æ›´æ”¹æŸ¥è¯¢å€¼

```ts
#JEDIæ˜¯é»˜è®¤å€¼
query HeroNameAndFriends($episode: Episode = "JEDI") {
  hero(episode: $episode) {
    name
    friends {
      name
    }
  }
}
```

### æŒ‡ä»¤ï¼š

åŠ¨æ€æ›´æ”¹æŸ¥è¯¢ç»“æ„

```ts
query Hero($episode: Episode, $withFriends: Boolean!) {
  hero(episode: $episode) {
    name
    friends @include(if: $withFriends) {
      name
    }
  }
}
```

```ts
{
  "episode": "JEDI",
  "withFriends": false
}
```

GraphQL çš„æ ¸å¿ƒè§„èŒƒåŒ…å«ä¸¤ä¸ªæŒ‡ä»¤ï¼Œå…¶å¿…é¡»è¢«ä»»ä½•è§„èŒƒå…¼å®¹çš„ GraphQL æœåŠ¡å™¨å®ç°æ‰€æ”¯æŒï¼š

- `@include(if: Boolean)` ä»…åœ¨å‚æ•°ä¸º `true` æ—¶ï¼ŒåŒ…å«æ­¤å­—æ®µã€‚
- `@skip(if: Boolean)` å¦‚æœå‚æ•°ä¸º `true`ï¼Œè·³è¿‡æ­¤å­—æ®µã€‚

### å˜æ›´

å…¶å®ä»»ä½•è¯­å¥éƒ½å¯ä»¥å®ç°å˜æ›´ï¼Œåªæ˜¯mutationè¯­ä¹‰ä¸Šæ›´åŠ ç¬¦åˆï¼Œå…·ä½“å®ç°è¦çœ‹resolver

```ts
mutation CreateReviewForEpisode($ep: Episode!, $review: ReviewInput!) {
  createReview(episode: $ep, review: $review) {
    stars
    commentary
  }
}
```

```ts
#æŸ¥è¯¢å˜é‡
{
  "ep": "JEDI",
  "review": {
    "stars": 5,
    "commentary": "This is a great movie!"
  }
}
```

æ³¨æ„ï¼Œåœ¨å¤šä¸ª `å­—æ®µ` å˜æ›´è¯·æ±‚ä¸­ï¼Œæ‰§è¡Œæ˜¯ç»§å‘çš„ã€‚**æŸ¥è¯¢å­—æ®µæ—¶ï¼Œæ˜¯å¹¶è¡Œæ‰§è¡Œï¼Œè€Œå˜æ›´å­—æ®µæ—¶ï¼Œæ˜¯çº¿æ€§æ‰§è¡Œï¼Œä¸€ä¸ªæ¥ç€ä¸€ä¸ªã€‚**

## ç±»å‹è¯­è¨€

ç§°ä¹‹ä¸º â€œGraphQL schema languageâ€

```graphql
type Character {
  name: String!
  appearsIn: [Episode!]!
}
```

ç±»å‹åˆ†ä¸ºï¼šæ ‡é‡ç±»å‹å’Œå¤æ‚ç±»å‹ï¼Œå¤æ‚ç±»å‹ä»¥æ ‡é‡ç±»å‹ä¸ºåŸºç¡€å †å èµ·æ¥çš„ç±»å‹ã€‚ä¾‹å¦‚ï¼šæšä¸¾ã€åˆ—è¡¨ã€æ¥å£ã€è”åˆã€è¾“å…¥ç±»å‹

### æ ‡é‡ç±»å‹æœ‰

- `Int`ï¼šæœ‰ç¬¦å· 32 ä½æ•´æ•°ã€‚
- `Float`ï¼šæœ‰ç¬¦å·åŒç²¾åº¦æµ®ç‚¹å€¼ã€‚
- `String`ï¼šUTFâ€8 å­—ç¬¦åºåˆ—ã€‚
- `Boolean`ï¼š`true` æˆ–è€… `false`ã€‚
- `ID`ï¼šID æ ‡é‡ç±»å‹è¡¨ç¤ºä¸€ä¸ªå”¯ä¸€æ ‡è¯†ç¬¦ï¼Œé€šå¸¸ç”¨ä»¥é‡æ–°è·å–å¯¹è±¡æˆ–è€…ä½œä¸ºç¼“å­˜ä¸­çš„é”®ã€‚ID ç±»å‹ä½¿ç”¨å’Œ String ä¸€æ ·çš„æ–¹å¼åºåˆ—åŒ–ï¼›ç„¶è€Œå°†å…¶å®šä¹‰ä¸º ID æ„å‘³ç€å¹¶ä¸éœ€è¦äººç±»å¯è¯»å‹ã€‚

å½“ç„¶ï¼Œè¿˜å¯ä»¥å®ç°è‡ªå®šä¹‰æ ‡é‡ç±»å‹

### æšä¸¾ç±»å‹

```graphql
enum Episode {
  NEWHOPE
  EMPIRE
  JEDI
}
```

### åˆ—è¡¨å’Œéç©º

```graphql
type Character {
  name: String!
  appearsIn: [Episode]!
}
```

`!` è¡¨ç¤ºéç©ºå­—æ®µï¼Œå¦‚æœå®ƒç»“æœå¾—åˆ°äº†ä¸€ä¸ªç©ºå€¼ï¼Œé‚£ä¹ˆäº‹å®ä¸Šå°†ä¼šè§¦å‘ä¸€ä¸ª GraphQL æ‰§è¡Œé”™è¯¯ï¼Œä»¥è®©å®¢æˆ·ç«¯çŸ¥é“å‘ç”Ÿäº†é”™è¯¯ã€‚

myField: [String!]è¡¨ç¤ºéç©ºå†…å®¹ï¼Œå†…å®¹ä¸èƒ½ä¸ºnull

myField: [String]!è¡¨ç¤ºéç©ºåˆ—è¡¨ï¼Œåˆ—è¡¨ä¸èƒ½ä¸ºnull

### æ¥å£

```graphql
interface Character {
  id: ID!
  name: String!
  friends: [Character]
}
```

å®ç°æ¥å£

```graphql
type Human implements Character {
  id: ID!
  name: String!
  friends: [Character]
  
  #å…¶ä»–ç±»å‹
  otherFiled1: Int
}
 
type Droid implements Character {
  id: ID!
  name: String!
  friends: [Character]
  
  otherFiled2: String!
}
```

### è”åˆç±»å‹

```graphql
union SearchResult = Human | Droid | Starship
```

æ³¨æ„ï¼Œè”åˆç±»å‹çš„æˆå‘˜éœ€è¦æ˜¯å…·ä½“å¯¹è±¡ç±»å‹ï¼›ä½ ä¸èƒ½ä½¿ç”¨æ¥å£æˆ–è€…å…¶ä»–è”åˆç±»å‹æ¥åˆ›é€ ä¸€ä¸ªè”åˆç±»å‹ã€‚

### è¾“å…¥ç±»å‹

ä»å®¢æˆ·ç«¯ä¼ é€’å¤æ‚ç±»å‹

```graphql
input ReviewInput {
  stars: Int!
  commentary: String
}
```

```
#é€šè¿‡è¾“å…¥çš„$reviewå»æŸ¥è¯¢å†…å®¹
mutation CreateReviewForEpisode($ep: Episode!, $review: ReviewInput!) {
  createReview(episode: $ep, review: $review) {
    stars
    commentary
  }
}
```

è¾“å…¥ç±»å‹ç¤ºä¾‹ï¼ˆç¤ºä¾‹æ¥æº[1]ï¼‰

```ts
type Account {
    name: String
    age: Int,
    sex: String,
    salary(city: String): Int
}

input AccountInput {
    name: String
    age: Int,
    sex: String
}

type Mutation {
    createAccount(input: AccountInput): Account
}
```

é‚£å¦‚ä½•ä¼ å‚å‘¢ï¼Ÿå¦‚ä¸‹ï¼š

```ts
mutation {
  createAccount(input: {
    name: "æå››"
    age: 10
    sex: "å¥³"
  }) {
    name
  }
}
```

> å…¶å®è¿™é‡Œå’Œä¸Šè¿°çš„ä¼ å‚æ–¹å¼æ²¡å•¥åŒºåˆ«ï¼Œå”¯ä¸€çš„ä¸åŒå°±æ˜¯ç±»å‹çš„è½¬å˜ï¼Œè¿™é‡Œå˜æˆäº†å¯¹è±¡æ–¹å¼çš„ä¼ å‚ã€‚

åœ¨ `@apollo/client` å®¢æˆ·ç«¯ä¸­å¦‚ä½•ä¼ é€’æ•°æ®å‘¢ï¼Ÿä¸‹é¢æ˜¯reactä¸­çš„å®ä¾‹ä»£ç ï¼ˆå‚è€ƒ**[2]**ï¼‰ï¼š

```ts
import { ApolloClient, InMemoryCache } from '@apollo/client'
import { THEGRAPH_URL } from '../services/config'

export const client = function (url: string) {
  return new ApolloClient({
    uri: '...',

    cache: new InMemoryCache({
      typePolicies: {
        Token: {
          // Singleton types that have no identifying field can use an empty
          // array for their keyFields.
          keyFields: false,
        },
        Pool: {
          // Singleton types that have no identifying field can use an empty
          // array for their keyFields.
          keyFields: false,
        },
      },
    }),
    queryDeduplication: true,
    defaultOptions: {
      watchQuery: {
        fetchPolicy: 'no-cache',
      },
      query: {
        fetchPolicy: 'no-cache',
        errorPolicy: 'all',
      },
    },
  })
}

const result = client(url).query({
  query: graphSql,
  variables: {}, //è¿™é‡Œä¼ å‚
})
```

[1] GraphQLä»å…¥é—¨åˆ°èµ·é£.https://juejin.cn/post/6897173001373483021#heading-33

[2] uniswap_v3é¡¹ç›®

## å†…çœ

å†…çœèƒ½å¹²å•¥ï¼Ÿç”¨äºæŸ¥è¯¢GraphQLæ”¯æŒå“ªäº›ä¸œè¥¿

### è¯¢é—®å“ªäº›ç±»å‹æ˜¯å¯ç”¨çš„

```ts
#è¯¢é—®å“ªäº›ç±»å‹æ˜¯å¯ç”¨çš„
{
  __schema {
    types {
      name
    }
  }
}
```

```ts
#å›ç­”
{
  "data": {
    "__schema": {
      "types": [
        {
          "name": "Query"
        },
        {
          "name": "String"
        },
        {
          "name": "ID"
        },
        
				...
        
        {
          "name": "ReviewInput"
        },
        {
          "name": "__Type"
        },
        
        ...
        
        {
          "name": "__DirectiveLocation"
        }
      ]
    }
  }
}
```

è¯´æ˜ï¼š**__Directive** - è¿™äº›æœ‰ç€ä¸¤ä¸ªä¸‹åˆ’çº¿çš„ç±»å‹æ˜¯å†…çœç³»ç»Ÿçš„ä¸€éƒ¨åˆ†ã€‚

### è¯¢é—®æ‰€æœ‰æŸ¥è¯¢å¼€å§‹çš„åœ°æ–¹

```ts
{
  __schema {
    queryType {
      name
    }
  }
}
```

```ts
#å›ç­”
{
  "data": {
    "__schema": {
      "queryType": {
        "name": "Query"
      }
    }
  }
}
```

### è¯¢é—®ç‰¹å®šçš„ç±»å‹

```ts
{
  __type(name: "Droid") {
    name
    kind #æ›´æ·±å…¥äº†è§£ç±»å‹
  }
}
```

```ts
#å›ç­”
{
  "data": {
    "__type": {
      "name": "Droid",
      "kind": "OBJECT"
    }
  }
}
```

è¯¢é—®å®ƒæœ‰å“ªäº›å­—æ®µï¼Œåˆ—å‡ºå®ƒçš„ `åç§°` ä»¥åŠ `ç±»å‹çš„åç§°` å’Œ `ç±»å‹çš„ç§ç±»`

```ts
{
  __type(name: "Droid") {
    name
    fields {
      name
      type {
        name
        kind
      }
    }
  }
}
```

```ts
#å›ç­”
{
  "data": {
    "__type": {
      "name": "Droid",
      "fields": [
        {
          "name": "id",
          "type": {
            "name": null,
            "kind": "NON_NULL"
          }
        },
        {
          "name": "name",
          "type": {
            "name": null,
            "kind": "NON_NULL"
          }
        },
        {
          "name": "friends",
          "type": {
            "name": null,
            "kind": "LIST"
          }
        },
      ]
    }
  }
}
```

ofTypeå¯ä»¥æŸ¥è¯¢åŒ…è£…ç±»å‹

```ts
ofType {
  name
  kind
}
```

```ts
#å›ç­”
"ofType": {
  "name": "String",
    "kind": "SCALAR"
}
```

# 17 fetchä½¿ç”¨æ–¹æ³•

```ts
fetch('http://example.com/movies.json')
  .then(function(response) {
    return response.json();
  })
  .then(function(myJson) {
    console.log(myJson);
  });
```

:warning: æ³¨æ„è¦ä».jsonä¸­æ‹¿åˆ°æ•°æ®

```ts
const res = await fetch('http://example.com/movies.json')
const data = await res.json()
//è¦è§£æä¸ºjsonæ ¼å¼
```

# 18 Apolloå®¢æˆ·ç«¯é…ç½®å¼‚æ­¥uri

æ€»ä½“æ€æƒ³ä¸ºï¼šåˆ©ç”¨ `fetch` å±æ€§æ”¯æŒå¼‚æ­¥å‡½æ•°ï¼Œæ¥è¿›è¡Œå¼‚æ­¥è·å–uri

```ts
const customFetch = async (uri, options) => {
  //å¼‚æ­¥è·å–uri
  
  const { operationName } = JSON.parse(options.body);
  return fetch(`${uri}/graph/graphql?opname=${operationName}`, options);
};

const link = new HttpLink({ fetch: customFetch });
```

:warning: æ³¨æ„ï¼šcustomFetchæ¯æ¬¡è¯·æ±‚éƒ½ä¼šè¿›æ¥ï¼Œæ‰€ä»¥å»ºè®®ä¸è¦åœ¨customFetchå†…éƒ¨è¿›è¡Œè¯·æ±‚ï¼Œè€Œæ˜¯è¯·æ±‚å¥½ï¼Œæ”¾å…¥å…¨å±€å˜é‡ï¼ˆæˆ–è€…çŠ¶æ€ç®¡ç†å™¨ï¼‰ä¸­ï¼Œåœ¨customFetchå†…éƒ¨é˜»å¡è·å–å·²è¯·æ±‚å¥½çš„uriå³å¯

# 19 åœ¨nestjsä¸­ä½¿ç”¨graphql

> TODO

æœ‰ä¸€äº›é—®é¢˜ï¼š

### 1.åœ¨resolverä¸­å¯¼å…¥çš„ç±»å‹ï¼Œå¯ä»¥æ¥è‡ªå®ä½“

```ts
import { Post } from './post.entity';

@Resolver((of) => Post)
```

### 2.@Qeury()è£…é¥°å™¨

```ts
@Query(() => Post, { name: 'post' })
```

å®ƒä¸€å…±æœ‰ä¸‰ä¸ªé‡è½½å‡½æ•°ï¼Œç¬¬äºŒä¸ªå‚æ•°å¯ä»¥å¯¹è¯¥å­—æ®µè¿›è¡Œ `æè¿°` ï¼ˆå­—æ®µåã€æè¿°ã€å¼ƒç”¨åŸå› ã€å¤æ‚çš„ï¼‰

```ts
export interface QueryOptions extends BaseTypeOptions {
    name?: string;
    description?: string;
    deprecationReason?: string;
    complexity?: Complexity;
}

export declare function Query(): MethodDecorator;
export declare function Query(name: string): MethodDecorator;
export declare function Query(typeFunc: ReturnTypeFunc, options?: QueryOptions): MethodDecorator;
```

åŒç†ï¼Œmutationä¹Ÿæœ‰å‡ ä¸ªé‡è½½æ–¹æ³•ï¼ŒMutationOptionsé€‰é¡¹ä¸QueryOptionsä¸€è‡´ï¼š

```ts
export declare function Mutation(): MethodDecorator;
export declare function Mutation(name: string): MethodDecorator;
export declare function Mutation(typeFunc: ReturnTypeFunc, options?: MutationOptions): MethodDecorator;
```

